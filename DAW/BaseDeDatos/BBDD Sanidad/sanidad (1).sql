SET AUTOCOMMIT=1;

CREATE DATABASE IF NOT EXISTS sanidad;

USE sanidad;

CREATE TABLE IF NOT EXISTS sanidad.HOSPITAL (
 HOSPITAL_COD   TINYINT (2) PRIMARY KEY,
 NOMBRE            VARCHAR(10) NOT NULL,
 DIRECCION         VARCHAR(20),
 TELEFONO        VARCHAR(8),
 NUM_CAMAS     SMALLINT(3) UNSIGNED DEFAULT 0 );

CREATE INDEX HOSPITAL_NOM ON sanidad.HOSPITAL (NOMBRE);


INSERT INTO sanidad.HOSPITAL VALUES (13,'Provincial','O Donell 50','964-4264',0);
INSERT INTO sanidad.HOSPITAL VALUES (18,'General','Atocha s/n','595-3111',0);
INSERT INTO sanidad.HOSPITAL VALUES (22,'La Paz','Castellana 1000','923-5411',0);
INSERT INTO sanidad.HOSPITAL VALUES (45,'San Carlos','Ciudad Universitaria', '597-1500',0);


CREATE TABLE IF NOT EXISTS sanidad.SALA (
 HOSPITAL_COD  TINYINT (2),
 SALA_COD      TINYINT (2),
 NOMBRE           VARCHAR(20) NOT NULL,
 NUM_CAMAS    SMALLINT(3) UNSIGNED DEFAULT 0,
 CONSTRAINT SALA_PK PRIMARY KEY (HOSPITAL_COD, SALA_COD),
 INDEX IDX_SALA_HOSPITAL_COD (HOSPITAL_COD),
 FOREIGN KEY (HOSPITAL_COD) REFERENCES sanidad.HOSPITAL(HOSPITAL_COD)) ;

CREATE INDEX SALA_HOSP_NOM ON sanidad.SALA (HOSPITAL_COD, NOMBRE);


INSERT INTO sanidad.SALA VALUES (13,3,'Cuidados Intensivos',21);
INSERT INTO sanidad.SALA VALUES (13,6,'Psiquiátrico',67);
INSERT INTO sanidad.SALA VALUES (18,3,'Cuidados Intensivos',10);
INSERT INTO sanidad.SALA VALUES (18,4,'Cardiología',53);
INSERT INTO sanidad.SALA VALUES (22,1,'Recuperación',10);
INSERT INTO sanidad.SALA VALUES (22,6,'Psiquiátrico',118);
INSERT INTO sanidad.SALA VALUES (22,2,'Maternidad',34);
INSERT INTO sanidad.SALA VALUES (45,4,'Cardiología',55);
INSERT INTO sanidad.SALA VALUES (45,1,'Recuperación',13);
INSERT INTO sanidad.SALA VALUES (45,2,'Maternidad',24);



UPDATE sanidad.HOSPITAL 
SET NUM_CAMAS = (SELECT SUM(NUM_CAMAS) 
                  FROM sanidad.SALA 
                  WHERE sanidad.HOSPITAL.HOSPITAL_COD = sanidad.SALA.HOSPITAL_COD);


CREATE TABLE IF NOT EXISTS sanidad.PLANTILLA (
 HOSPITAL_COD  TINYINT (2),
 SALA_COD      TINYINT (2),
 EMPLEADO_NUM    SMALLINT(4) NOT NULL,
 NOMBRE        VARCHAR (15) NOT NULL,
 FUNCION        VARCHAR (10), 
 TURNO          VARCHAR (1) CHECK (TURNO IN ('M','T','N')),
 SALARIO        INT (10),
 CONSTRAINT PLANTILLA_PK PRIMARY KEY (HOSPITAL_COD, SALA_COD, EMPLEADO_NUM),
 INDEX IDX_PLANTILLA_HOSP_SALA (HOSPITAL_COD, SALA_COD),
 FOREIGN KEY (HOSPITAL_COD, SALA_COD) REFERENCES sanidad.SALA (HOSPITAL_COD, SALA_COD)) ;  

CREATE INDEX PLANTILLA_HOSP_NOMBRE ON sanidad.PLANTILLA (HOSPITAL_COD, NOMBRE);
CREATE INDEX PLANTILLA_HOSP_FUNCION ON sanidad.PLANTILLA (HOSPITAL_COD, FUNCION);
CREATE INDEX PLANTILLA_FUNCIO_HOSP_SALA ON sanidad.PLANTILLA (FUNCION, HOSPITAL_COD, SALA_COD);


INSERT INTO sanidad.PLANTILLA VALUES(13,6,3754,'Díaz B.','Infermera','T',2262000);
INSERT INTO sanidad.PLANTILLA VALUES(13,6,3106,'Hernández J.','Infermero','T',2755000); 
INSERT INTO sanidad.PLANTILLA VALUES(18,4,6357,'Karplus W.','Interno','T',3379000);
INSERT INTO sanidad.PLANTILLA VALUES(22,6,1009,'Higueras D.','Infermera','T',2005000);
INSERT INTO sanidad.PLANTILLA VALUES(22,6,8422,'Bocina G.','Infermero','M',1638000);
INSERT INTO sanidad.PLANTILLA VALUES(22,2,9901,'Adams C.','Interno','M',2210000);
INSERT INTO sanidad.PLANTILLA VALUES(22,1,6065,'Rivera G.','Infermera','N',1626000);
INSERT INTO sanidad.PLANTILLA VALUES(22,1,7379,'Carlos R.','Infermera','T',2119000);
INSERT INTO sanidad.PLANTILLA VALUES(45,4,1280,'Amigó R.','Interno','N',2210000);
INSERT INTO sanidad.PLANTILLA VALUES(45,1,8526,'Frank H.','Infermera','T',2522000);



CREATE TABLE IF NOT EXISTS sanidad.ENFERMO (
 INSCRIPCION    INT (5) PRIMARY KEY,  
 NOMBRE        VARCHAR (15) NOT NULL,
 DIRECCION        VARCHAR (20),
 FECHA_NAC     DATE,
 SEXO          CHAR (1) NOT NULL  CHECK (SEXO = 'H' OR SEXO = 'D'),
 NSS           CHAR(9)) ;

CREATE INDEX ENFERMO_NAIX_NOMBRE ON sanidad.ENFERMO (FECHA_NAC, NOMBRE);
CREATE INDEX ENFERMO_NOMBRE_NAIX ON sanidad.ENFERMO (NOMBRE, FECHA_NAC);


INSERT INTO sanidad.ENFERMO VALUES(10995,'Laguía M.','Goya 20','1956-05-16','H',280862482);
INSERT INTO sanidad.ENFERMO VALUES(18004,'Serrano V.','Alcala 12','1960-05-21','D',284991452);
INSERT INTO sanidad.ENFERMO VALUES(14024,'Fernández M.','Recoletos 50','1967-06-23','D',321790059);
INSERT INTO sanidad.ENFERMO VALUES(36658,'Domin S.','Mayor 71','1942-01-01','H',160657471);
INSERT INTO sanidad.ENFERMO VALUES(38702,'Neal R.','Orense 11','1940-06-18','D',380010217);
INSERT INTO sanidad.ENFERMO VALUES(39217,'Cervantes M.','Peron 38','1952-02-29','H',440294390);
INSERT INTO sanidad.ENFERMO VALUES(59076,'Miller G.','Lopez de Hoyos 2','1945-09-16','D',311969044);
INSERT INTO sanidad.ENFERMO VALUES(63827,'Ruíz P.','Esquerdo 103','1980-12-26','H',100973253);
INSERT INTO sanidad.ENFERMO VALUES(64823,'Fraser A.','Soto 3','1980-07-10','D',285201776);
INSERT INTO sanidad.ENFERMO VALUES(74835,'Benítez E.','Argentina 5','1957-10-05','H',154811767);


CREATE TABLE IF NOT EXISTS sanidad.INGRESOS (
 INSCRIPCION    INT (5) PRIMARY KEY,
 HOSPITAL_COD  TINYINT (2) NOT NULL,
 SALA_COD      TINYINT (2) NOT NULL,
 CAMA          SMALLINT(4) UNSIGNED,
 INDEX IDX_INGRESOS_INSCRIPCION (INSCRIPCION),
 INDEX IDX_INGRESOS_HOSP_SALA (HOSPITAL_COD, SALA_COD),
 FOREIGN KEY (INSCRIPCION) REFERENCES sanidad.ENFERMO(INSCRIPCION),
 FOREIGN KEY (HOSPITAL_COD, SALA_COD) REFERENCES sanidad.SALA (HOSPITAL_COD, SALA_COD));

CREATE INDEX INGRESOS_HOSP_SALA ON sanidad.INGRESOS (HOSPITAL_COD, SALA_COD);


INSERT INTO sanidad.INGRESOS VALUES(10995,13,3,1);
INSERT INTO sanidad.INGRESOS VALUES(18004,13,3,2);
INSERT INTO sanidad.INGRESOS VALUES(14024,13,3,3);
INSERT INTO sanidad.INGRESOS VALUES(36658,18,4,1);
INSERT INTO sanidad.INGRESOS VALUES(38702,18,4,2);
INSERT INTO sanidad.INGRESOS VALUES(39217,22,6,1);
INSERT INTO sanidad.INGRESOS VALUES(59076,22,6,2);
INSERT INTO sanidad.INGRESOS VALUES(63827,22,6,3);
INSERT INTO sanidad.INGRESOS VALUES(64823,22,2,1);



CREATE TABLE IF NOT EXISTS sanidad.DOCTOR (
 HOSPITAL_COD  TINYINT (2),
 DOCTOR_NO     SMALLINT(3),
 NOMBRE        VARCHAR(13) NOT NULL,
 ESPECIALIDAD  VARCHAR(16) NOT NULL,
 CONSTRAINT DOCTOR_PK PRIMARY KEY (HOSPITAL_COD, DOCTOR_NO),
 INDEX IDX_DOCTOR_HOSP (HOSPITAL_COD),
 FOREIGN KEY (HOSPITAL_COD) REFERENCES sanidad.HOSPITAL(HOSPITAL_COD)) ;


INSERT INTO sanidad.DOCTOR VALUES(13,435,'López A.','Cardiologia');
INSERT INTO sanidad.DOCTOR VALUES(18,585,'Miller G.','Ginecologia');
INSERT INTO sanidad.DOCTOR VALUES(18,982,'Cajal R.','Cardiologia');
INSERT INTO sanidad.DOCTOR VALUES(22,453,'Galo D.','Pediatria');
INSERT INTO sanidad.DOCTOR VALUES(22,398,'Best K.','Urologia');
INSERT INTO sanidad.DOCTOR VALUES(22,386,'Cabeza D.','Psiquiatria');
INSERT INTO sanidad.DOCTOR VALUES(45,607,'Nico P.','Pediatria');
INSERT INTO sanidad.DOCTOR VALUES(45,522,'Adams C.','Neurologia');


CREATE INDEX DOCTOR_ESP_HOSP ON sanidad.DOCTOR (ESPECIALIDAD, HOSPITAL_COD);
CREATE INDEX DOCTOR_HOSP_ESP ON sanidad.DOCTOR (HOSPITAL_COD, ESPECIALIDAD);

